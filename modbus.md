# 查询

主机: 01 03 00 00 00 01 84 0A

01-地址，也就是你传感器的地址
03-功功能码，03代表查询功能，查询传感器的数据
00 00-代表查询的起始寄存器地址.说明从0x0000开始查询。这里需要说明以下，Modbus把数据存放在寄存器中，通过查询寄存器来得到不同变量的值，一个寄存器地址对应2字节数据
00 01-代表查询了一个寄存器.结合前面的00 00,意思就是查询从0开始的1个寄存器值
84 0A-循环冗余校验,是modbus的校验公式,从首个字节开始到84前面为止;

从机: 01 03 02 19 98 B2 7E

01-地址，也就是你传感器的地址
03-功功能码，03代表查询功能，查询传感器的数据。这里要注意的是注意发给从机的功能码是啥，从机就要回复同样的功能码，如果不一样说明这一帧数据有错误
02-代表后面数据的字节数,因为上面说到,一个寄存器有2个字节,所以后面的字节数肯定是2*查询的寄存器个数;
19 98-寄存器的值是19 98,结合发送的数据看出,01这个寄存器的值为19 98
B2 7E-循环冗余校验



## 修改

主机发送: 01 06 00 00 00 01 48 0A

01-主机要查询的从机地址
06-功能码,06代表修改单个寄存器功能,修改有些不同,有修改一个寄存器和修改多个寄存器;
00 00-代表修改的起始寄存器地址.说明从0x0000开始.
00 01-代表修改的值为00 01.结合前面的00 00,意思就是修改0号寄存器值为00 01;
48 0A-循环冗余校验,是modbus的校验公式,从首个字节开始到48前面为止;

从机回复: 01 06 00 00 00 01 48 0A

01-从机返回给主机自己的地址,说明这就是主机查的从机
06-功能码,代表修改单个寄存器功能，主机发啥功能码，从机就必须回什么功能码;
00 00-代表修改的起始寄存器地址.说明是0x0000.
00 01-代表修改的值为00 01.结合前面的00 00,意思就是修改0号寄存器值为00 01;
48 0A-循环冗余校验,是modbus的校验公式,从首个字节开始到48前面为止;

# modbus-tcp协议

Modbus-TCP 是基于 TCP 的 Modbus 协议扩展，其数据包由 7 字节的协议头 和 Modbus 应用数据单元（PDU） 组成：

| 字节 0-1 | Transaction ID (2字节) 
| 字节 2-3 | Protocol ID (2字节, 固定0x0000) 
| 字节 4-5 | Length (2字节, 后续字节长度) 代表我的后面有几个字节
| 字节 6   | Unit ID (1字节, 设备地址)
| 字节 7+  | PDU (应用数据单元)

Modbus TCP/IP的报文帧主要包括：

MBAP头：包含事务标识符、协议标识符、消息长度、设备地址 => 前6个字节

Modbus PDU：原始Modbus协议的数据部分，包括功能码、数据地址和数据值。

